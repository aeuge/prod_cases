Q:
покиньте идей, как ускорить пагинацию. Сейчас работает через count limit offset, в таблице 10 млн строк, горячих данных порядка 1 млн строк, нагрузка в основном читающая, поиск для пагинацию по атрибутам (комбинация из 20 атрибутов). Индексы под запросы есть. Выборки могут возвращать до 30 тыс строк, страница 1000 строк. После девятой-десятой страницы запрос отрабатывает больше 4 сек, далее линейно растет

Стенд:
Горячие данные в памяти
Серверы виртуальные, кластер patroni из трёх серверов, читают в основном с реплик
Процентов 80 запросов с пагинацией, выборки по атрибутам произвольные, в основном 3-5 атрибутов
Каждые 20 30 сек уходит на 10+ страницу, первая страница на модельных запросах выдаётся примерно за полсекунды, потом 4++
Postgres 16

Уточнение задачи:
Select id, f1,...fn from table where f5=4 and f6=1 and f9 between 5 and 8 order by id limit 1000 offset 28000;
Выполняется 5 сек

Как решать задачу:
эксплейн нужен же и профайлинг
на че он время то тратит
по какому индексу идет
тут еще нюанс - что выборка по одним полям - а сортировка по другому

Варианты решений:
сразу формировать больле и как вариант был закешировать на беке - слишком большой объем, не так часто уходят дальше 1 страницы
условие в выборку больше последнего значения выданного в 1 странице и выдать снова первую страницу - усложняется код

A:
Select id, f1,...fn from table where id in(select id from table where f5=4 and f6=1 and f9 between 5 and 8 order by id limit 1000 offset 28000)
Выполняется 0.3 сек
По индексу фильтрует что в первом что во втором случае. Просто в первом случае тащит и выбрасывает offset широкую строку, а во втором случае один int.